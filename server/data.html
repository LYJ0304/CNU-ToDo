<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ íŒŒì¼ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
        }
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        #drop-zone {
            border: 3px dashed #adb5bd;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            font-size: 1.1em;
            color: #6c757d;
            background-color: #fff;
            margin-bottom: 30px;
            transition: border-color 0.3s, background-color 0.3s;
        }
        #drop-zone.dragover {
            border-color: #007bff;
            background-color: #e9ecef;
        }
        #file-list {
            margin-top: 15px;
            font-size: 0.9em;
            color: #495057;
        }
        #spinner {
            display: none;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #results-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .metric-card {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .metric-card h3 {
            margin-top: 0;
            color: #007bff;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            font-size: 1.2em;
        }
        .metric-card p {
            margin: 8px 0;
            font-size: 0.95em;
        }
        .metric-card strong {
            color: #343a40;
        }
        .metric-card ul {
            padding-left: 20px;
            font-size: 0.9em;
        }
        .metric-card table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
        }
        .metric-card th, .metric-card td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: left;
        }
        .metric-card th {
            background-color: #f8f9fa;
            color: #495057;
        }
        #raw-json-output-container {
             background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        #raw-json-output-container h2 {
             margin-top: 0;
             color: #2c3e50;
        }
        pre {
            background-color: #282c34; /* Dark background for JSON */
            color: #abb2bf; /* Light text for JSON */
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 0.85em;
            line-height: 1.6;
            white-space: pre-wrap; /* Wrap long lines in JSON */
        }
        code {
            background-color: #e9ecef;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š ë¡œê·¸ íŒŒì¼ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h1>
        <div id="drop-zone">
            <p>ì—¬ê¸°ì— ë¡œê·¸ íŒŒì¼ì„ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•˜ì„¸ìš”.</p>
            <p>(.txt, .log ë˜ëŠ” í™•ì¥ì ì—†ëŠ” íŒŒì¼)</p>
            <div id="file-list"></div>
            <div id="spinner"></div>
        </div>

        <div id="results-dashboard">
            </div>

        <div id="raw-json-output-container" style="display: none;">
            <h2>ğŸ“‹ Raw JSON ìƒì„¸ ë¶„ì„ ê²°ê³¼:</h2>
            <pre id="analysis-results-json">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</pre>
        </div>
    </div>

    <script>
        function analyzeLogFiles(logSources) {
          const analysis = {
            overallStats: {
              totalProcessedEntries: 0, firstTimestamp: null, lastTimestamp: null,
              serverStarts: 0, serverStops: 0, logFileNames: [], uniqueUserIDs: 0,
            },
            userActivity: {},
            errorAnalysis: {
              fileReadErrors: 0, fileReadErrorDetails: [],
              skillCallFailures: 0, skillCallFailureDetails: [],
            },
            httpRequestAnalysis: {
              totalRequests: 0, gets: 0, posts: 0, statusCodes: {},
              ips: {}, notFoundPaths: {},
            },
            logManagement: { logClearScheduled: 0, logClearScheduleTimes: [] },
          };

          const actualLogPieces = [];
          logSources.forEach((source, index) => {
            let fileName = source.fileName || `LogSource_${index + 1}`;
            let content = source.fullContent || "";
            analysis.overallStats.logFileNames.push(fileName);
            const lines = content.split('\n');
            lines.forEach(line => {
              const text = line.replace(/^\\s*/, '').trim();
              if (text !== "") actualLogPieces.push(text);
            });
          });

          const processedLogEntries = [];
          let currentEntryBuffer = "";
          actualLogPieces.forEach(piece => {
            if (/^\[\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}\(KST\)\]/.test(piece)) {
              if (currentEntryBuffer !== "") processedLogEntries.push(currentEntryBuffer.trim());
              currentEntryBuffer = piece;
            } else {
              currentEntryBuffer += (currentEntryBuffer ? " " : "") + piece;
            }
          });
          if (currentEntryBuffer !== "") processedLogEntries.push(currentEntryBuffer.trim());
          analysis.overallStats.totalProcessedEntries = processedLogEntries.length;

          const tsRegex = /^\[(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3})\(KST\)\]/;
          const idActRegex = /^\s*([0-9a-f]{64,66})\s+(.+)/;
          const srvStartRegex = /ì„œë²„ ì‹œì‘: ì„œë²„ê°€ ë‚´ë¶€ í¬íŠ¸ \d+ì—ì„œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤\./;
          const srvStopRegex = /ì„œë²„ê°€ ì¢…ë£Œë©ë‹ˆë‹¤\./;
          const logClrRegex = /ë‹¤ìŒ ë¡œê·¸ ì •ë¦¬ ì˜ˆì•½ë¨: ([\dTZ:\.-]+)/;
          const fReadErrDetRegex = /íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: í•´ì‹œëœ í•™ë²ˆ ([0-9a-f]{64,66}) - ENOENT: no such file or directory, open '(.+)'/;
          const fReadErrGenPrefix = "íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:";
          const skillFailRegex = /ìŠ¤í‚¬ í˜¸ì¶œ ì‹¤íŒ¨: userId=(\d+)ì— í•´ë‹¹í•˜ëŠ” í•™ë²ˆ ì •ë³´ ì—†ìŒ/;
          const httpReqRegex = /^(::ffff:[\d\.]+)\s(GET|POST)\s(.+?)\s(\d{3})\s(\d+ms)/;

          processedLogEntries.forEach(entry => {
            if (entry.trim() === "") return;
            let tsMatch = entry.match(tsRegex);
            let timestamp = null, msgContent = entry;

            if (tsMatch) {
              timestamp = tsMatch[1];
              msgContent = entry.substring(tsMatch[0].length).trim();
              if (!analysis.overallStats.firstTimestamp || timestamp < analysis.overallStats.firstTimestamp) analysis.overallStats.firstTimestamp = timestamp;
              if (!analysis.overallStats.lastTimestamp || timestamp > analysis.overallStats.lastTimestamp) analysis.overallStats.lastTimestamp = timestamp;
            }

            if (srvStartRegex.test(msgContent)) analysis.overallStats.serverStarts++;
            else if (srvStopRegex.test(msgContent)) analysis.overallStats.serverStops++;
            else {
              const logClrMatch = msgContent.match(logClrRegex);
              if (logClrMatch) {
                analysis.logManagement.logClearScheduled++;
                analysis.logManagement.logClearScheduleTimes.push(logClrMatch[1]);
              }
            }

            const httpMatch = msgContent.match(httpReqRegex);
            if (httpMatch) {
              analysis.httpRequestAnalysis.totalRequests++;
              const [, ip, method, pathQuery, codeStr] = httpMatch;
              const statusCode = parseInt(codeStr);
              const path = pathQuery.split(' ')[0];
              if (method === "GET") analysis.httpRequestAnalysis.gets++; else if (method === "POST") analysis.httpRequestAnalysis.posts++;
              analysis.httpRequestAnalysis.statusCodes[statusCode] = (analysis.httpRequestAnalysis.statusCodes[statusCode] || 0) + 1;
              analysis.httpRequestAnalysis.ips[ip] = (analysis.httpRequestAnalysis.ips[ip] || 0) + 1;
              if (statusCode === 404) analysis.httpRequestAnalysis.notFoundPaths[path] = (analysis.httpRequestAnalysis.notFoundPaths[path] || 0) + 1;
            } else {
              const idActMatch = msgContent.match(idActRegex);
              if (idActMatch) {
                const hashedId = idActMatch[1];
                const action = idActMatch[2].trim();
                if (!analysis.userActivity[hashedId]) analysis.userActivity[hashedId] = { actions: [], updateTimeSaves: 0, todoListSaves: 0, successfulQueries: 0, kakaoTodoQueries: 0, studentIdUpdates: 0, otherActionCount: 0 };
                analysis.userActivity[hashedId].actions.push({ timestamp, action });
                if (action === "UpdateTimeë§Œ ì €ì¥") analysis.userActivity[hashedId].updateTimeSaves++;
                else if (action === "ToDoList ì €ì¥") analysis.userActivity[hashedId].todoListSaves++;
                else if (action === "ì¹´í†¡ íˆ¬ë‘ ì¡°íšŒ") analysis.userActivity[hashedId].kakaoTodoQueries++;
                else if (action === "í•™ë²ˆ ë“±ë¡/ì—…ë°ì´íŠ¸") analysis.userActivity[hashedId].studentIdUpdates++;
                else {
                  const fReadDetForIdMatch = action.match(/^íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: í•´ì‹œëœ í•™ë²ˆ .+ ENOENT: no such file or directory, open '(.+)'/);
                  if (action.startsWith(fReadErrGenPrefix) && fReadDetForIdMatch) {
                    analysis.errorAnalysis.fileReadErrors++;
                    analysis.errorAnalysis.fileReadErrorDetails.push({ timestamp, hashedId, filePath: fReadDetForIdMatch[1], fullMessage: `${hashedId} ${action}` });
                  } else if (action.startsWith(fReadErrGenPrefix)) {
                    analysis.errorAnalysis.fileReadErrors++;
                    analysis.errorAnalysis.fileReadErrorDetails.push({ timestamp, hashedId, filePath: "N/A", fullMessage: `${hashedId} ${action}` });
                  } else analysis.userActivity[hashedId].otherActionCount++;
                }
              } else if (msgContent.startsWith("í•´ì‹œëœ í•™ë²ˆ ") && msgContent.endsWith(" ì¡°íšŒ ì„±ê³µ")) {
                const parts = msgContent.split(" ");
                if (parts.length >= 3) {
                  const hashedId = parts[2];
                  if (!analysis.userActivity[hashedId]) analysis.userActivity[hashedId] = { actions: [], updateTimeSaves: 0, todoListSaves: 0, successfulQueries: 0, kakaoTodoQueries: 0, studentIdUpdates: 0, otherActionCount: 0 };
                  analysis.userActivity[hashedId].successfulQueries++;
                  analysis.userActivity[hashedId].actions.push({ timestamp, action: "ì¡°íšŒ ì„±ê³µ" });
                }
              } else {
                const fReadDetMatch = msgContent.match(fReadErrDetRegex);
                if (fReadDetMatch) {
                  analysis.errorAnalysis.fileReadErrors++;
                  analysis.errorAnalysis.fileReadErrorDetails.push({ timestamp, hashedId: fReadDetMatch[1], filePath: fReadDetMatch[2], fullMessage: msgContent });
                } else if (msgContent.startsWith(fReadErrGenPrefix)) {
                  analysis.errorAnalysis.fileReadErrors++;
                  analysis.errorAnalysis.fileReadErrorDetails.push({ timestamp, hashedId: "N/A", filePath: "N/A", fullMessage: msgContent });
                }
                const skillFailMatch = msgContent.match(skillFailRegex);
                if (skillFailMatch) {
                  analysis.errorAnalysis.skillCallFailures++;
                  analysis.errorAnalysis.skillCallFailureDetails.push({ timestamp, userId: skillFailMatch[1], fullMessage: msgContent });
                }
              }
            }
          });
          analysis.overallStats.uniqueUserIDs = Object.keys(analysis.userActivity).length;
          return analysis;
        }

        // --- UI Rendering Functions ---
        function displayAnalysis(results) {
            const dashboard = document.getElementById('results-dashboard');
            dashboard.innerHTML = ''; // Clear previous results

            renderOverallSummary(results.overallStats, dashboard);
            renderUserActivitySummary(results.userActivity, dashboard);
            renderErrorSummary(results.errorAnalysis, dashboard);
            renderHttpSummary(results.httpRequestAnalysis, dashboard);
            renderTopUsers(results.userActivity, dashboard);
            renderFileReadErrors(results.errorAnalysis.fileReadErrorDetails, dashboard);
            renderHttp404Paths(results.httpRequestAnalysis.notFoundPaths, dashboard);
            renderTopIPs(results.httpRequestAnalysis.ips, dashboard);

            const rawJsonContainer = document.getElementById('raw-json-output-container');
            const resultsPre = document.getElementById('analysis-results-json');
            if (resultsPre && rawJsonContainer) {
                resultsPre.textContent = JSON.stringify(results, null, 2);
                rawJsonContainer.style.display = 'block'; // Show raw JSON
            }
            document.getElementById('spinner').style.display = 'none';
        }

        function createCard(title, icon = '') {
            const card = document.createElement('div');
            card.className = 'metric-card';
            const cardTitle = document.createElement('h3');
            cardTitle.innerHTML = `${icon} ${title}`; // Allow HTML for icon
            card.appendChild(cardTitle);
            return card;
        }

        function addStatToCard(card, label, value) {
            const p = document.createElement('p');
            p.innerHTML = `<strong>${label}:</strong> ${value}`;
            card.appendChild(p);
        }

        function renderOverallSummary(stats, parentElement) {
            const card = createCard("ì „ì²´ ìš”ì•½", "ğŸ“Š");
            addStatToCard(card, "ì²˜ë¦¬ëœ ë¡œê·¸ í•­ëª©", stats.totalProcessedEntries);
            addStatToCard(card, "ë¡œê·¸ íŒŒì¼ ìˆ˜", stats.logFileNames.length);
            addStatToCard(card, "ì²« ë¡œê·¸ ì‹œê°„", stats.firstTimestamp || "N/A");
            addStatToCard(card, "ë§ˆì§€ë§‰ ë¡œê·¸ ì‹œê°„", stats.lastTimestamp || "N/A");
            addStatToCard(card, "ì„œë²„ ì‹œì‘", stats.serverStarts);
            addStatToCard(card, "ì„œë²„ ì¢…ë£Œ", stats.serverStops);
            addStatToCard(card, "ê³ ìœ  ì‚¬ìš©ì ID", stats.uniqueUserIDs);
            parentElement.appendChild(card);
        }

        function renderUserActivitySummary(userActivity, parentElement) {
            const card = createCard("ì‚¬ìš©ì í™œë™", "ğŸ‘¥");
            let totalUpdateTimeSaves = 0, totalTodoListSaves = 0, totalSuccessfulQueries = 0,
                totalKakaoTodoQueries = 0, totalStudentIdUpdates = 0, totalOtherActions = 0;

            for (const id in userActivity) {
                totalUpdateTimeSaves += userActivity[id].updateTimeSaves;
                totalTodoListSaves += userActivity[id].todoListSaves;
                totalSuccessfulQueries += userActivity[id].successfulQueries;
                totalKakaoTodoQueries += userActivity[id].kakaoTodoQueries;
                totalStudentIdUpdates += userActivity[id].studentIdUpdates;
                totalOtherActions += userActivity[id].otherActionCount;
            }
            addStatToCard(card, "ì´ 'UpdateTime ì €ì¥'", totalUpdateTimeSaves);
            addStatToCard(card, "ì´ 'ToDoList ì €ì¥'", totalTodoListSaves);
            addStatToCard(card, "ì´ 'ì¡°íšŒ ì„±ê³µ'", totalSuccessfulQueries);
            addStatToCard(card, "ì´ 'ì¹´í†¡ íˆ¬ë‘ ì¡°íšŒ'", totalKakaoTodoQueries);
            addStatToCard(card, "ì´ 'í•™ë²ˆ ë“±ë¡/ì—…ë°ì´íŠ¸'", totalStudentIdUpdates);
            parentElement.appendChild(card);
        }

        function renderErrorSummary(errorAnalysis, parentElement) {
            const card = createCard("ì˜¤ë¥˜ ìš”ì•½", "âš ï¸");
            addStatToCard(card, "íŒŒì¼ ì½ê¸° ì˜¤ë¥˜", errorAnalysis.fileReadErrors);
            addStatToCard(card, "ìŠ¤í‚¬ í˜¸ì¶œ ì‹¤íŒ¨", errorAnalysis.skillCallFailures);
            parentElement.appendChild(card);
        }

        function renderHttpSummary(httpAnalysis, parentElement) {
            const card = createCard("HTTP ìš”ì²­", "ğŸŒ");
            addStatToCard(card, "ì´ ìš”ì²­", httpAnalysis.totalRequests);
            addStatToCard(card, "GET ìš”ì²­", httpAnalysis.gets);
            addStatToCard(card, "POST ìš”ì²­", httpAnalysis.posts);
            if(Object.keys(httpAnalysis.statusCodes).length > 0) {
                const p = document.createElement('p');
                p.innerHTML = "<strong>ìƒíƒœ ì½”ë“œ:</strong>";
                card.appendChild(p);
                const ul = document.createElement('ul');
                for (const code in httpAnalysis.statusCodes) {
                    const li = document.createElement('li');
                    li.textContent = `Status ${code}: ${httpAnalysis.statusCodes[code]}`;
                    ul.appendChild(li);
                }
                card.appendChild(ul);
            }
            parentElement.appendChild(card);
        }

        function renderTopUsers(userActivity, parentElement, topN = 5) {
            const users = Object.entries(userActivity).map(([id, data]) => ({
                id, totalActions: data.actions.length, ...data
            })).sort((a, b) => b.totalActions - a.totalActions);

            if(users.length === 0) return;

            const card = createCard(`ìƒìœ„ ${topN} ì‚¬ìš©ì (í™œë™ ê¸°ì¤€)`, "ğŸ†");
            const table = document.createElement('table');
            table.innerHTML = `<thead><tr><th>Hashed ID (ì¶•ì•½)</th><th>ì´ í™œë™</th><th>ToDo ì €ì¥</th><th>UpdateTime</th><th>ì¡°íšŒ</th></tr></thead>`;
            const tbody = document.createElement('tbody');
            users.slice(0, topN).forEach(user => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td><code>${user.id.substring(0,12)}...</code></td><td>${user.totalActions}</td><td>${user.todoListSaves}</td><td>${user.updateTimeSaves}</td><td>${user.successfulQueries}</td>`;
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
            card.appendChild(table);
            parentElement.appendChild(card);
        }

        function renderFileReadErrors(errorDetails, parentElement, maxDisplay = 5) {
            if (!errorDetails || errorDetails.length === 0) return;
            const card = createCard(`íŒŒì¼ ì½ê¸° ì˜¤ë¥˜ (ìµœëŒ€ ${maxDisplay}ê°œ í‘œì‹œ)`, "ğŸ“„");
            const list = document.createElement('ul');
            errorDetails.slice(0, maxDisplay).forEach(err => {
                const listItem = document.createElement('li');
                let displayMsg = `ID: <code>${err.hashedId ? err.hashedId.substring(0,10) : 'N/A'}...</code>`;
                if (err.filePath && err.filePath !== "N/A") {
                    displayMsg += ` - Path: <code>${err.filePath.substring(err.filePath.lastIndexOf('/') + 1)}</code>`;
                } else {
                    displayMsg += ` - ${err.fullMessage.substring(0,30)}...`;
                }
                if (err.timestamp) listItem.innerHTML = `<b>${err.timestamp.split('T')[1].split('.')[0]}</b>: ${displayMsg}`;
                else listItem.innerHTML = displayMsg;
                list.appendChild(listItem);
            });
            if (errorDetails.length > maxDisplay) {
                const p = document.createElement('p');
                p.textContent = `... ì™¸ ${errorDetails.length - maxDisplay}ê°œì˜ ì˜¤ë¥˜`;
                list.appendChild(p);
            }
            card.appendChild(list);
            parentElement.appendChild(card);
        }

        function renderHttp404Paths(notFoundPaths, parentElement, topN = 5) {
            const paths = Object.entries(notFoundPaths).sort(([,a],[,b]) => b-a);
            if (paths.length === 0) return;

            const card = createCard(`ìƒìœ„ ${topN} Not Found (404) ê²½ë¡œ`, "ğŸš«");
            const table = document.createElement('table');
            table.innerHTML = `<thead><tr><th>ê²½ë¡œ</th><th>íšŸìˆ˜</th></tr></thead>`;
            const tbody = document.createElement('tbody');
            paths.slice(0, topN).forEach(([path, count]) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td><code>${path.length > 40 ? path.substring(0,37)+'...' : path}</code></td><td>${count}</td>`;
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
            card.appendChild(table);
            parentElement.appendChild(card);
        }

         function renderTopIPs(ips, parentElement, topN = 5) {
            const sortedIps = Object.entries(ips).sort(([,a],[,b]) => b-a);
            if(sortedIps.length === 0) return;

            const card = createCard(`ìƒìœ„ ${topN} ìš”ì²­ IP ì£¼ì†Œ`, "ğŸ“¡");
            const table = document.createElement('table');
            table.innerHTML = `<thead><tr><th>IP ì£¼ì†Œ</th><th>ìš”ì²­ ìˆ˜</th></tr></thead>`;
            const tbody = document.createElement('tbody');
            sortedIps.slice(0, topN).forEach(([ip, count]) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${ip}</td><td>${count}</td>`;
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
            card.appendChild(table);
            parentElement.appendChild(card);
        }


        // --- Drag and Drop Logic ---
        const dropZone = document.getElementById('drop-zone');
        const fileListDiv = document.getElementById('file-list');
        const spinner = document.getElementById('spinner');
        const resultsDashboard = document.getElementById('results-dashboard');
        const rawJsonContainer = document.getElementById('raw-json-output-container');
        const resultsPreJson = document.getElementById('analysis-results-json');

        dropZone.addEventListener('dragover', (event) => {
            event.preventDefault();
            dropZone.classList.add('dragover');
        });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
        dropZone.addEventListener('drop', (event) => {
            event.preventDefault();
            dropZone.classList.remove('dragover');
            spinner.style.display = 'block';
            fileListDiv.textContent = 'íŒŒì¼ ì²˜ë¦¬ ì¤‘...';
            resultsDashboard.innerHTML = '<p>ë¶„ì„ ì¤‘...</p>';
            rawJsonContainer.style.display = 'none';

            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const filePromises = Array.from(files).map(file => {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = (e) => resolve({ fileName: file.name, fullContent: e.target.result });
                        reader.onerror = (e) => reject(new Error(`íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ${file.name}`));
                        reader.readAsText(file);
                    });
                });

                fileListDiv.textContent = `ì—…ë¡œë“œëœ íŒŒì¼: ${Array.from(files).map(f => f.name).join(', ')}`;

                Promise.all(filePromises)
                    .then(logSources => {
                        try {
                            const analysisResults = analyzeLogFiles(logSources);
                            displayAnalysis(analysisResults); // Use the new display function
                        } catch (error) {
                            resultsDashboard.innerHTML = `<p style="color:red;">ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}</p>`;
                            resultsPreJson.textContent = error.stack;
                            rawJsonContainer.style.display = 'block';
                            console.error("Analysis error:", error);
                        } finally {
                            spinner.style.display = 'none';
                        }
                    })
                    .catch(error => {
                        resultsDashboard.innerHTML = `<p style="color:red;">íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}</p>`;
                        console.error("File reading error:", error);
                        spinner.style.display = 'none';
                        fileListDiv.textContent = '';
                    });
            } else {
                spinner.style.display = 'none';
                fileListDiv.textContent = '';
                resultsDashboard.innerHTML = '<p>ë¶„ì„í•  íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        });
    </script>
</body>
</html>